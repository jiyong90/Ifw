<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.isu.ifw.mapper.WtmInterfaceMapper">
	<select id="getWtmCodeId" parameterType="map" resultType="hashmap">
        <![CDATA[
			SELECT CODE_ID
			  FROM WTM_CODE
			 WHERE TENANT_ID = #{tenantId}
			   AND ENTER_CD = #{enterCd}
			   AND GRP_CODE_CD = #{grpCodeCd}
			   AND CODE_CD = #{codeCd}
			   AND CODE_NM = #{codeNm}
			   AND SYMD = #{symd}
        ]]>
    </select>
    
    <update id="insertWtmCode" parameterType="hashmap">
		<![CDATA[
			INSERT INTO WTM_CODE
			(
				  TENANT_ID
				, ENTER_CD 
				, GRP_CODE_CD 
				, CODE_CD 
				, CODE_NM 
				, SYMD 
				, EYMD 
				, NOTE
				, UPDATE_DATE
				, UPDATE_ID
			) VALUES (
				  #{tenantId}
				, #{enterCd}
				, #{grpCodeCd}
				, #{codeCd}
				, #{codeNm}
				, #{symd}
				, #{eymd}
				, #{note}
				, NOW()
				, 0
			)
		]]>
	</update>
	
	<update id="updateWtmCode" parameterType="hashmap">
		<![CDATA[
			UPDATE WTM_CODE SET
			    NOTE = #{note}
			  , UPDATE_DATE = NOW()
			  , UPDATE_ID = 0
			WHERE CODE_ID = #{codeId}
		]]>
	</update>
	
	<update id="updateWtmCodeEymd" parameterType="hashmap">
		<![CDATA[
			UPDATE WTM_CODE SET
			    EYMD = DATE_FORMAT(DATE_ADD(STR_TO_DATE(#{symd}, '%Y%m%d'), INTERVAL - 1 DAY), '%Y%m%d')
			  , UPDATE_DATE = NOW()
			  , UPDATE_ID = 0
			WHERE TENANT_ID = #{tenantId}
			  AND ENTER_CD = #{enterCd}
			  AND GRP_CODE_CD = #{grpCodeCd}
			  AND CODE_CD = #{codeCd}
			  AND SYMD <> #{symd}
			  AND SYMD < #{symd}
		]]>
	</update>
	
	<select id="getWtmCodeEymd" parameterType="map" resultType="hashmap">
        <![CDATA[
			SELECT DATE_FORMAT(DATE_ADD(STR_TO_DATE(SYMD, '%Y%m%d'), INTERVAL - 1 DAY), '%Y%m%d') AS EYMD
			  FROM WTM_CODE
			 WHERE TENANT_ID = #{tenantId}
			   AND ENTER_CD = #{enterCd}
			   AND GRP_CODE_CD = #{grpCodeCd}
			   AND CODE_CD = #{codeCd}
			   AND SYMD <> #{symd}
			   AND SYMD > #{symd}
        ]]>
    </select>
</mapper>
