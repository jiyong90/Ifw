<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.isu.ifw.mapper.WtmFlexibleStdMapper">
    <select id="getWtmFlexibleStd" parameterType="map" resultType="wtmFlexibleStd">
        <![CDATA[
			SELECT F_DATE_FORMAT(F_TO_DATE(F_STR_CONCAT(S.USE_SYMD, S.WORK_SHM), '%Y%m%d%H%i'), '%H:%i') AS WORK_SHM
			     , F_DATE_FORMAT(F_TO_DATE(F_STR_CONCAT(S.USE_SYMD, S.WORK_EHM), '%Y%m%d%H%i'), '%H:%i') AS WORK_EHM
			     , F_DATE_FORMAT(F_TO_DATE(F_STR_CONCAT(S.USE_SYMD, S.CORE_SHM), '%Y%m%d%H%i'), '%H:%i') AS CORE_SHM
			     , F_DATE_FORMAT(F_TO_DATE(F_STR_CONCAT(S.USE_SYMD, S.CORE_EHM), '%Y%m%d%H%i'), '%H:%i') AS CORE_EHM
			     , C.APPL_NM AS WORK_TYPE_NM 
			     , S.*
			     , C.*
			  FROM WTM_FLEXIBLE_STD_MGR S 
			  JOIN WTM_APPL_CODE C
			    ON C.ENTER_CD = S.ENTER_CD
			   AND C.TENANT_ID = S.TENANT_ID
			   AND S.WORK_TYPE_CD = C.APPL_CD
			 WHERE S.TENANT_ID = #{tenantId}
			   AND S.ENTER_CD = #{enterCd}
			   AND #{d} BETWEEN S.USE_SYMD AND S.USE_EYMD
			 ORDER BY S.USE_SYMD DESC
        ]]>
    </select>
    <select id="checkRequestDate" parameterType="Long" resultType="map">
        <![CDATA[
        	SELECT SUM(XX.CNT) FROM (
			SELECT COUNT(*) AS CNT
			  FROM WTM_APPL A
			  JOIN WTM_FLEXIBLE_APPL F
			   ON A.APPL_ID = F.APPL_ID
			  JOIN (
				SELECT A.TENANT_ID, A.ENTER_CD, A.APPL_SABUN, F.SYMD, F.EYMD
				  FROM WTM_APPL A
				  JOIN WTM_FLEXIBLE_APPL F
				    ON A.APPL_ID = F.APPL_ID
				   AND A.APPL_ID = #{applId}
			  ) X
			   ON A.TENANT_ID = X.TENANT_ID AND A.ENTER_CD = X.ENTER_CD AND A.APPL_SABUN = X.APPL_SABUN
			WHERE A.APPL_STATUS_CD NOT IN ('11','22','44','32') 
			  AND (X.SYMD <= F.EYMD OR X.EYMD <= F.SYMD)
			UNION
		   SELECT COUNT(*)
		     FROM WTM_FLEXIBLE_EMP A
			 JOIN (
				SELECT A.TENANT_ID, A.ENTER_CD, A.APPL_SABUN, F.SYMD, F.EYMD
				  FROM WTM_APPL A
				  JOIN WTM_FLEXIBLE_APPL F
				    ON A.APPL_ID = F.APPL_ID
				   AND A.APPL_ID = #{applId}
			  	) X
			   ON A.TENANT_ID = X.TENANT_ID AND A.ENTER_CD = X.ENTER_CD AND A.SABUN = X.APPL_SABUN
            WHERE  (X.SYMD <= A.EYMD OR X.EYMD <= A.SYMD)
            ) XX
        ]]>
    </select>
     
</mapper>
