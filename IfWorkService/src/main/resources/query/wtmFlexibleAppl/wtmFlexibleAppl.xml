<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.isu.ifw.mapper.WtmFlexibleApplMapper">
	<select id="getWtmFlexibleAppl" parameterType="map" resultType="wtmFlexibleAppl">
        <![CDATA[
			SELECT FA.*
			  FROM WTM_APPL A
			  JOIN WTM_FLEXIBLE_APPL FA
			    ON A.APPL_ID = FA.APPL_ID 
			 WHERE A.TENANT_ID = #{tenantId}
			   AND A.ENTER_CD = #{enterCd}
			   AND A.APPL_SABUN = #{sabun}
			   AND F_TO_DATE(#{sYmd},'%Y%m%d') BETWEEN F_TO_DATE(FA.SYMD,'%Y%m%d') AND F_TO_DATE(FA.EYMD,'%Y%m%d')
        ]]>
    </select>
    
    <select id="getWtmFlexibleApplImsi" parameterType="map" resultType="hashmap">
        <![CDATA[
			SELECT FA.FLEXIBLE_APPL_ID AS flexibleApplId
			     , FA.FLEXIBLE_STD_MGR_ID AS flexibleStdMgrId
			     , FA.APPL_ID AS applId
			     , FA.YM AS ym
			     , FA.SYMD AS sYmd
			     , FA.EYMD AS eYmd
			     , FA.WORK_DAY AS workDay
			     , FA.REASON AS reason
			     , A.APPL_STATUS_CD AS applStatusCd
			  FROM WTM_APPL A
			  JOIN WTM_FLEXIBLE_APPL FA
			    ON A.APPL_ID = FA.APPL_ID 
			 WHERE A.TENANT_ID = #{tenantId}
			   AND A.ENTER_CD =  #{enterCd}
			   AND (A.APPL_SABUN,SYMD) IN (SELECT A.APPL_SABUN, MAX(SYMD)
										     FROM WTM_APPL A
										     JOIN WTM_FLEXIBLE_APPL FA
										       ON A.APPL_ID = FA.APPL_ID 
										    WHERE A.TENANT_ID = #{tenantId}
										      AND A.ENTER_CD =  #{enterCd}
										      AND A.APPL_SABUN = #{sabun}
										   GROUP BY A.APPL_SABUN )	   
        ]]>
    </select>
</mapper>
