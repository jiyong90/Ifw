<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.isu.ifw.mapper.WtmCalendarMapper">
	<select id="getCalendar" parameterType="map" resultType="hashmap">
        <![CDATA[
			SELECT F_WTM_DATE_FORMAT(d.SUN_YMD,'%Y-%m-%d') as sunYmd
			     , d.DAY_NM as dayNm
			     , d.NOTE as note
			     , F_WTM_DATE_FORMAT(d.MOON_YMD,'%Y-%m-%d') as moonYmd
			     , F_WTM_DATE_FORMAT(h.HOLIDAY_YMD,'%Y-%m-%d') as holidayYmd
			     , h.HOLIDAY_NM as holidayNm
			  FROM WTM_DAY_MGR d
			  LEFT OUTER JOIN WTM_HOLIDAY_MGR h
			    ON 'Y' = ( CASE WHEN h.SUN_YN = 'Y' AND d.SUN_YMD = h.HOLIDAY_YMD THEN 'Y'
			                    WHEN h.SUN_YN = 'N' AND d.MOON_YMD = h.HOLIDAY_YMD THEN 'Y'
			                    ELSE 'N' END ) 
			 WHERE (h.TENANT_ID IS NULL OR h.TENANT_ID = #{tenantId})
			   AND (#{enterCd, jdbcType=VARCHAR} IS NULL OR h.ENTER_CD IS NULL OR h.ENTER_CD = #{enterCd, jdbcType=VARCHAR})
			   AND (#{bisinessPlaceCd, jdbcType=VARCHAR} IS NULL OR h.BISINESS_PLACE_CD IS NULL OR h.BISINESS_PLACE_CD = #{bisinessPlaceCd, jdbcType=VARCHAR})
			   AND F_WTM_DATE_FORMAT(F_WTM_TO_DATE(SUN_YMD,'%Y%m%d'),'%Y%m') = #{ym}
			ORDER BY d.SUN_YMD
        ]]>
    </select>
    
    <select id="getWorkCalendar" parameterType="map" resultType="hashmap">
        <![CDATA[
			select 1
			  from dual
        ]]>
    </select>

    <select id="getWorkTimeCalendar" parameterType="map" resultType="hashmap">
        <![CDATA[
			select info_key
			     , info_name
			     , info_data
			  from comm_management_infomation
			 where tenant_id = #{tenantId}
        ]]>
    </select>
    
    <select id="getEmpWorkCalendar" parameterType="map" resultType="hashmap">
        <![CDATA[
	        SELECT A.WORK_CALENDAR_ID as workCalendarId, 
				A.TENANT_ID as tenantId, 
				A.ENTER_CD as enterCd, 
				A.SABUN as sabun, 
				F_WTM_GET_EMP_CODE_NM(#{tenantId}, #{enterCd}, A.SABUN, 'ORG_CD', date_format(now(),'%Y%m%d')) AS orgNm,
				F_WTM_GET_EMP_NM(#{tenantId}, #{enterCd}, A.SABUN, date_format(now(),'%Y%m%d')) AS empNm,
				A.YMD as ymd, 
				A.FLEXIBLE_EMP_ID as flexibleEmpId, 
				B.FLEXIBLE_STD_MGR_ID as flexibleStdMgrId,
				A.TIME_CD_MGR_ID as timeCdMgrId,
				A.ENTRY_SDATE as entrySdate,
				A.ENTRY_STYPE_CD as entryStypeCd,
				A.ENTRY_EDATE as entryEdate,
				A.ENTRY_ETYPE_CD as enteryEtypeCd,
				A.WORK_CLOSE_YN as workCloseYn,
				A.HOLIDAY_YN as holidayYn,
				A.NOTE as note
				FROM WTM_WORK_CALENDAR A
			JOIN WTM_FLEXIBLE_EMP B ON B.FLEXIBLE_EMP_ID=A.FLEXIBLE_EMP_ID
			WHERE YMD BETWEEN #{sYmd} AND #{eYmd}
			ORDER BY YMD DESC
        ]]>
    </select>
</mapper>
