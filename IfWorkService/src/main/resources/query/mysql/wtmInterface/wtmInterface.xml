<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.isu.ifw.mapper.WtmInterfaceMapper">

	<select id="getIfLastDate" parameterType="map" resultType="hashmap">
        <![CDATA[
        	SELECT F_WTM_DATE_FORMAT(MAX(UPDATE_DATE), 'YMDHIS') AS lastDate
			  FROM WTM_IF_HIS
			 WHERE TENANT_ID = #{tenantId}
			   AND IF_ITEM = #{ifType}
			   AND IF_STATUS = 'OK'
        ]]>
    </select>
    <select id="getIfNowDate" parameterType="map" resultType="hashmap">
        <![CDATA[
        	SELECT F_WTM_DATE_FORMAT(NOW(), 'YMDHIS') AS ifDate
			  FROM DUAL
        ]]>
    </select>
    
    <select id="getIfUrl" parameterType="map" resultType="hashmap">
        <![CDATA[
        	SELECT info_data as infoData
			  FROM comm_management_infomation
			 WHERE tenant_id = #{tenantId}
			   AND info_key = 'HR.IT_URL'
        ]]>
    </select>
    
	<insert id="insertIfHis" parameterType="hashmap">
		INSERT INTO WTM_IF_HIS
		(
			  TENANT_ID
			, IF_STATUS
			, IF_ITEM 
			, IF_SEARCH_DATE 
			, IF_MSG 
			, UPDATE_DATE
		) VALUES (
			  #{tenantId}
			, #{ifStatus}
			, #{ifItem}
			, F_WTM_TO_DATE(#{ifEndDate}, 'YMDHIS')
			, #{ifMsg}
			, F_WTM_TO_DATE(#{updateDate}, 'YMDHIS')
		)
	</insert>
	
	<select id="getWtmCodeId" parameterType="map" resultType="hashmap">
        <![CDATA[
			SELECT CODE_ID as codeId
			  FROM WTM_CODE
			 WHERE TENANT_ID = #{tenantId}
			   AND ENTER_CD = #{enterCd}
			   AND GRP_CODE_CD = #{grpCodeCd}
			   AND CODE_CD = #{codeCd}
			   AND CODE_NM = #{codeNm}
			   AND SYMD = #{symd}
        ]]>
    </select>
    
    <insert id="insertWtmCode" parameterType="hashmap">
			INSERT INTO WTM_CODE
			(
				  TENANT_ID
				, ENTER_CD 
				, GRP_CODE_CD 
				, CODE_CD 
				, CODE_NM 
				, SYMD 
				, EYMD 
				, SEQ
				, NOTE
				, UPDATE_DATE
				, UPDATE_ID
			) VALUES 
			<foreach collection="list" item="item" separator=", ">
			(     #{item.tenantId}
	        	, #{item.enterCd}
	        	, #{item.grpCodeCd}
	        	, #{item.codeCd}
	        	, #{item.codeNm}
	        	, #{item.symd}
	        	, #{item.eymd}
	        	, #{item.seq}
	        	, #{item.note}
	        	, NOW()
	        	, '0'
	        )
			</foreach>
	</insert>
	
	<update id="updateWtmCode" parameterType="hashmap">
		UPDATE WTM_CODE SET
		    NOTE = CASE
		    <foreach collection="list" item="item" separator="">
		        when CODE_ID = #{item.codeId} then #{item.note}
		    </foreach>
    		END
		  , UPDATE_DATE = NOW()
		  , UPDATE_ID = '0'
		WHERE CODE_ID IN
		<foreach collection="list" item="item" open="(" close=")" separator=", ">
			#{item.codeId}
		</foreach>
	</update>
	
	<update id="updateWtmCodeHisEymd" parameterType="hashmap">
		<![CDATA[
			UPDATE WTM_CODE
			   SET EYMD =F_WTM_NVL(F_WTM_DATE_FORMAT(DATE_ADD(F_WTM_TO_DATE(#{symd}, 'YMD'), INTERVAL -1 DAY), 'YMD'), '29991231')
			  , UPDATE_DATE = NOW()
			  , UPDATE_ID = '0'
			WHERE 1=1
			  AND TENANT_ID = #{tenantId}
			  AND ENTER_CD = #{enterCd}
			  AND GRP_CODE_CD = #{grpCodeCd}
			  AND CODE_CD = #{codeCd}
			  AND #{symd} > SYMD
		]]>
	</update>
	
	<update id="updateWtmCodeHisSymd" parameterType="hashmap" >
        <![CDATA[
			UPDATE WTM_CODE
			   SET SYMD =F_WTM_NVL(F_WTM_DATE_FORMAT(DATE_ADD(F_WTM_TO_DATE(#{eymd}, 'YMD'), INTERVAL -1 DAY), 'YMD'), '29991231')
			  , UPDATE_DATE = NOW()
			  , UPDATE_ID = '0'
			WHERE 1=1
			  AND TENANT_ID = #{tenantId}
			  AND ENTER_CD = #{enterCd}
			  AND GRP_CODE_CD = #{grpCodeCd}
			  AND CODE_CD = #{codeCd}
			  AND #{symd} < SYMD
        ]]>
    </update>
    
    <insert id="insertWtmHoliday" parameterType="java.util.HashMap" >
        INSERT INTO WTM_HOLIDAY_MGR (
        	  TENANT_ID
        	, ENTER_CD
        	, BISINESS_PLACE_CD
        	, HOLIDAY_YMD
        	, HOLIDAY_NM
        	, SUN_YN
        	, FESTIVE_YN
        	, PAY_YN
        	, NOTE
        	, UPDATE_DATE
        	, UPDATE_ID
        ) VALUES 
       <foreach collection="list" item="item" separator=", ">
		(     #{item.tenantId}
        	, #{item.enterCd}
        	, #{item.locationCd}
        	, #{item.holidayYmd}
        	, #{item.holidayNm}
        	, #{item.sunYn}
        	, #{item.festiveYn}
        	, #{item.payYn}
        	, #{item.note}
        	, NOW()
        	, '0'
        )
		</foreach>
        ON DUPLICATE KEY UPDATE
              HOLIDAY_NM = VALUES(HOLIDAY_NM)
            , SUN_YN = VALUES(SUN_YN)
            , FESTIVE_YN = VALUES(FESTIVE_YN)
            , PAY_YN = VALUES(PAY_YN)
            , NOTE = VALUES(NOTE)
            , UPDATE_DATE = NOW()
            , UPDATE_ID = '0'
    </insert>
    
    <select id="getWtmTaaCodeId" parameterType="map" resultType="hashmap">
		SELECT TAA_CODE_ID as taaCodeId
		  FROM WTM_TAA_CODE
		 WHERE TENANT_ID = #{tenantId}
		   AND ENTER_CD = #{enterCd}
		   AND TAA_CD = #{taaCd}
    </select>
    
    <insert id="insertTaaCode" parameterType="hashmap">
		INSERT INTO WTM_TAA_CODE
		(
			  TENANT_ID
			, ENTER_CD 
			, TAA_CD 
			, TAA_NM 
			, TAA_TYPE_CD 
			, HOL_INCL_YN 
			, REQUEST_TYPE_CD 
			, WORK_YN
			, PAY_YN
			, NOTE
			, UPDATE_DATE
			, UPDATE_ID
		) VALUES 
		<foreach collection="list" item="item" separator=", ">
			(
			  #{item.tenantId}
			, #{item.enterCd}
			, #{item.taaCd}
			, #{item.taaNm}
			, #{item.taaTypeCd}
			, #{item.holInclYn}
			, #{item.requestTypeCd}
			, #{item.workYn}
        	, #{item.payYn}
        	, #{item.note}
			, NOW()
			, '0'
			)
		</foreach>
	</insert>
	
	<update id="updateTaaCode" parameterType="hashmap">
		UPDATE WTM_TAA_CODE SET
		    TAA_NM = CASE 
		    <foreach collection="list" item="item" separator="">
		        when TAA_CODE_ID = #{item.taaCodeId} then #{item.taaNm}
		    </foreach> END
		  , TAA_TYPE_CD = CASE 
		    <foreach collection="list" item="item" separator="">
		        when TAA_CODE_ID = #{item.taaCodeId} then #{item.taaTypeCd}
		    </foreach> END
		  , HOL_INCL_YN = CASE 
		    <foreach collection="list" item="item" separator="">
		        when TAA_CODE_ID = #{item.taaCodeId} then #{item.holInclYn}
		    </foreach> END
		  , REQUEST_TYPE_CD = CASE 
		    <foreach collection="list" item="item" separator="">
		        when TAA_CODE_ID = #{item.taaCodeId} then #{item.requestTypeCd}
		    </foreach> END
		  , WORK_YN = CASE 
		    <foreach collection="list" item="item" separator="">
		        when TAA_CODE_ID = #{item.taaCodeId} then #{item.workYn}
		    </foreach> END
		  , PAY_YN = CASE 
		    <foreach collection="list" item="item" separator="">
		        when TAA_CODE_ID = #{item.taaCodeId} then #{item.payYn}
		    </foreach> END
		  , NOTE = CASE 
		    <foreach collection="list" item="item" separator="">
		        when TAA_CODE_ID = #{item.taaCodeId} then #{item.note}
		    </foreach> END
		  , UPDATE_DATE = NOW()
		  , UPDATE_ID = '0'
		WHERE TAA_CODE_ID IN 
		<foreach collection="list" item="item" open="(" close=")" separator=", ">
			#{item.taaCodeId}
		</foreach>
	</update>
	
	<insert id="insertWtmOrgCode" parameterType="java.util.HashMap" >
        INSERT INTO WTM_ORG_CODE (
        	  TENANT_ID
        	, ENTER_CD
        	, ORG_CD
        	, SYMD
        	, ORG_NM
        	, EYMD
        	, ORG_TYPE
        	, NOTE
        	, UPDATE_DATE
        	, UPDATE_ID
        ) VALUES 
       <foreach collection="list" item="item" separator=", ">
		(     #{item.tenantId}
        	, #{item.enterCd}
        	, #{item.orgCd}
        	, #{item.symd}
        	, #{item.orgNm}
        	, #{item.eymd}
        	, #{item.orgType}
        	, #{item.note}
        	, NOW()
        	, '0'
        )
		</foreach>
        ON DUPLICATE KEY UPDATE
              ORG_NM = VALUES(ORG_NM)
            , ORG_TYPE = VALUES(ORG_TYPE)
            , EYMD = VALUES(EYMD)
            , NOTE = VALUES(NOTE)
            , UPDATE_DATE = NOW()
            , UPDATE_ID = '0'
    </insert>
    
    <update id="updateWtmOrgCodeHisEymd" parameterType="hashmap">
		<![CDATA[
			UPDATE WTM_ORG_CODE
			   SET EYMD =F_WTM_NVL(F_WTM_DATE_FORMAT(DATE_ADD(F_WTM_TO_DATE(#{symd}, 'YMD'), INTERVAL -1 DAY), 'YMD'), '29991231')
			  , UPDATE_DATE = NOW()
			  , UPDATE_ID = '0'
			WHERE 1=1
			  AND TENANT_ID = #{tenantId}
			  AND ENTER_CD = #{enterCd}
			  AND ORG_CD = #{orgCd}
			  AND #{symd} > SYMD
		]]>
	</update>
	
	<update id="updateWtmOrgCodeHisSymd" parameterType="hashmap" >
        <![CDATA[
			UPDATE WTM_ORG_CODE
			   SET SYMD =F_WTM_NVL(F_WTM_DATE_FORMAT(DATE_ADD(F_WTM_TO_DATE(#{eymd}, 'YMD'), INTERVAL -1 DAY), 'YMD'), '29991231')
			  , UPDATE_DATE = NOW()
			  , UPDATE_ID = '0'
			WHERE 1=1
			  AND TENANT_ID = #{tenantId}
			  AND ENTER_CD = #{enterCd}
			  AND ORG_CD = #{orgCd}
			  AND #{symd} < SYMD
        ]]>
    </update>
    
    <select id="getWtmOgrChartId" parameterType="map" resultType="hashmap">
		SELECT ORG_CHART_ID as orgChartId
		  FROM WTM_ORG_CHART
		 WHERE TENANT_ID = #{tenantId}
		   AND ENTER_CD = #{enterCd}
		   AND SYMD = #{symd}
    </select>
    
    <insert id="insertWtmOrgChart" parameterType="java.util.HashMap" >
        INSERT INTO WTM_ORG_CHART (
        	  TENANT_ID
        	, ENTER_CD
        	, ORG_CHART_NM
        	, SYMD
        	, EYMD
        	, NOTE
        	, UPDATE_DATE
        	, UPDATE_ID
        ) VALUES 
       
		(     #{tenantId}
        	, #{enterCd}
        	, #{orgChartNm}
        	, #{symd}
        	, #{eymd}
        	, #{note}
        	, NOW()
        	, '0'
        )
    </insert>
    
    <update id="updateWtmOrgChart" parameterType="hashmap">
		UPDATE WTM_ORG_CHART SET
		    ORG_CHART_NM = #{orgChartNm}
		  , EYMD = #{eymd}
		  , NOTE = #{note}
		  , UPDATE_DATE = NOW()
		  , UPDATE_ID = '0'
		WHERE ORG_CHART_ID = #{orgChartId}
	</update>
	
    <insert id="insertWtmOrgChartDet" parameterType="java.util.HashMap" >
        INSERT INTO WTM_ORG_CHART_DET (
        	  ORG_CHART_ID
        	, ORG_CD
        	, PRIOR_ORG_CD
        	, SEQ
        	, ORG_LEVEL
        	, ORDER_SEQ
        	, UPDATE_DATE
        	, UPDATE_ID
        ) VALUES 
       <foreach collection="list" item="item" separator=", ">
		(     #{item.orgChartId}
        	, #{item.orgCd}
        	, #{item.priorOrgCd}
        	, #{item.seq}
        	, #{item.orgLevel}
        	, #{item.orderSeq}
        	, NOW()
        	, '0'
        )
		</foreach>
        ON DUPLICATE KEY UPDATE
              PRIOR_ORG_CD = VALUES(PRIOR_ORG_CD)
            , SEQ = VALUES(SEQ)
            , ORG_LEVEL = VALUES(ORG_LEVEL)
            , ORDER_SEQ = VALUES(ORDER_SEQ)
            , UPDATE_DATE = NOW()
            , UPDATE_ID = '0'
    </insert>
	
	<insert id="insertEmpHisTemp" parameterType="hashmap">
		INSERT INTO WTM_IF_EMP_TEMP
		(
			  TENANT_ID
			, ENTER_CD
			, SABUN
			, EMP_NM
			, EMP_ENG_NM
			, SYMD
			, EYMD
			, STATUS_CD
			, ORG_CD
			, BUSINESS_PLACE_CD
			, DUTY_CD
			, POS_CD
			, CLASS_CD
			, JOB_GROUP_CD
			, JOB_CD
			, PAY_TYPE_CD
			, ORG_PATH
			, NOTE
		) VALUES 
		<foreach collection="list" item="item" separator=", ">
			(
			  #{item.tenantId}
			, #{item.enterCd}
			, #{item.sabun}
			, #{item.empNm}
			, #{item.empEngNm}
			, #{item.symd}
			, #{item.eymd}
			, #{item.statusCd}
			, #{item.orgCd}
			, #{item.businessPlaceCd}
			, #{item.dutyCd}
			, #{item.posCd}
			, #{item.classCd}
			, #{item.jobGroupCd}
			, #{item.jobCd}
			, #{item.payTypeCd}
			, #{item.orgPath}
			, #{item.note}
			)
		</foreach>
	</insert>
	
	<select id="setEmpHis" statementType="CALLABLE" parameterType="java.util.HashMap" >
  		{ call P_WTM_IF_EMP_HIS( 
  				#{tenantId, jdbcType=BIGINT, javaType=java.lang.Long, mode=IN}
  			  , #{nowDataTime, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{retCode,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}) }
  	</select>
  	
  	<select id="getEmpBaseList" parameterType="map" resultType="hashmap">
  	<![CDATA[
		SELECT A.TENANT_ID AS tenantId 
			 , A.ENTER_CD as enterCd 
			 , A.SABUN as sabun
			 , GREATEST(A.SYMD, F_WTM_DATE_FORMAT(F_WTM_DATE_ADD(NOW(), -1, 'M'), 'YMD')) AS symd
			 , LEAST(A.EYMD, F_WTM_DATE_FORMAT(F_WTM_DATE_ADD(NOW(), 1, 'M'), 'YMD')) AS eymd
			 , '0' as userId
		  FROM WTM_EMP_HIS A
		 INNER JOIN WTM_IF_EMP_MSG B
			 ON A.TENANT_ID = B.TENANT_ID
			AND A.ENTER_CD = B.ENTER_CD
			AND A.SABUN = B.SABUN
			AND A.EYMD = '29991231'
			AND A.STATUS_CD = 'AA'
		 WHERE B.TENANT_ID = #{tenantId}
		   AND F_WTM_DATE_FORMAT(B.UPDATE_DATE, 'YMDHIS') BETWEEN #{ifEndDate} AND #{updateDate}
		   AND B.CHG_TYPE_CD = 'BUSINESS_PLACE_CD'
		   AND B.NEW_VALUE IS NOT NULL
		 UNION
		 SELECT A.TENANT_ID  AS tenantId 
		 	   , A.ENTER_CD as enterCd 
		 	   , A.SABUN as sabun
		 	   , GREATEST(A.SYMD, F_WTM_DATE_FORMAT(F_WTM_DATE_ADD(NOW(), -1, 'M'), 'YMD')) AS symd
		 	   , LEAST(A.EYMD, F_WTM_DATE_FORMAT(F_WTM_DATE_ADD(NOW(), 1, 'M'), 'YMD')) AS eymd
		 	   , '0' as userId
		  FROM WTM_EMP_HIS A
		 INNER JOIN WTM_IF_EMP_MSG B
			 ON A.TENANT_ID = B.TENANT_ID
			AND A.ENTER_CD = B.ENTER_CD
			AND A.SABUN = B.SABUN
			AND A.EYMD = '29991231'
			AND A.STATUS_CD = 'AA'
		 WHERE B.TENANT_ID = #{tenantId}
		   AND F_WTM_DATE_FORMAT(B.UPDATE_DATE, 'YMDHIS') BETWEEN #{ifEndDate} AND #{updateDate}
		   AND B.CHG_TYPE_CD = 'STATUS_CD'
		   AND B.OLD_VALUE != 'AA'
		 ORDER BY enterCd, sabun
    ]]>
    </select>
    
    <select id="getOrgConcChk" parameterType="map" resultType="hashmap">
  	<![CDATA[
		SELECT A.LEADER_CNT as leaderCnt, B.CONC_CNT as concCnt, C.CONC_CNT as concEndCnt
		  FROM (SELECT COUNT(*) AS LEADER_CNT
							  FROM WTM_EMP_HIS
							 WHERE TENANT_ID = #{tenantId}
							   AND ENTER_CD = #{enterCd}
							   AND ORG_CD = #{orgCd}
							   AND SABUN = #{sabun}
							   AND LEADER_YN = 'Y'
							   AND EYMD = #{eymd}) A
		 INNER JOIN (SELECT COUNT(*) AS CONC_CNT
					  FROM WTM_ORG_CONC
					 WHERE TENANT_ID = #{tenantId}
					   AND ENTER_CD = #{enterCd}
					   AND ORG_CD = #{orgCd}
					   AND SABUN = #{sabun}
					   AND SYMD = #{symd}
					   AND EYMD = #{eymd}) B
		INNER JOIN (SELECT COUNT(*) AS CONC_CNT
					  FROM WTM_ORG_CONC
					 WHERE TENANT_ID = #{tenantId}
					   AND ENTER_CD = #{enterCd}
					   AND ORG_CD = #{orgCd}
					   AND SABUN = #{sabun}
					   AND SYMD = #{symd}
					   AND EYMD <> #{eymd}) C
		    ON 1=1
    ]]>
    </select>
    
    <insert id="insertOrgConc" parameterType="java.util.HashMap" >
        INSERT INTO WTM_ORG_CONC (
        	  TENANT_ID
        	, ENTER_CD
        	, ORG_CD
        	, SABUN
        	, SYMD
        	, EYMD
        	, UPDATE_DATE
        	, UPDATE_ID
        ) VALUES (     
              #{tenantId}
        	, #{enterCd}
        	, #{orgCd}
        	, #{sabun}
        	, #{symd}
        	, #{eymd}
        	, NOW()
        	, '0'
        )
    </insert>
    
    <update id="updateOrgConcEnd" parameterType="java.util.HashMap" >
        UPDATE WTM_ORG_CONC SET
        	  EYMD = #{eymd}
        	, UPDATE_DATE = NOW()
        	, UPDATE_ID = '0'
         WHERE TENANT_ID = #{tenantId}
           AND ENTER_CD = #{enterCd}
           AND ORG_CD = #{orgCd}
           AND SABUN = #{sabun}
           AND SYMD = #{symd}
    </update>
    
    <insert id="insertWtmEmpAddr" parameterType="java.util.HashMap" >
        INSERT INTO WTM_EMP_ADDR (
        	  TENANT_ID
        	, ENTER_CD
        	, SABUN
        	, EMAIL
        	, HAND_PHONE
        	, NOTE
        	, UPDATE_DATE
        	, UPDATE_ID
        ) VALUES 
       <foreach collection="list" item="item" separator=", ">
		(     #{item.tenantId}
        	, #{item.enterCd}
        	, #{item.sabun}
        	, #{item.email}
        	, #{item.handPhone}
        	, #{item.note}
        	, NOW()
        	, '0'
        )
		</foreach>
        ON DUPLICATE KEY UPDATE
              EMAIL = VALUES(EMAIL)
            , HAND_PHONE = VALUES(HAND_PHONE)
            , NOTE = VALUES(NOTE)
            , UPDATE_DATE = NOW()
            , UPDATE_ID = '0'
    </insert>
    
    <select id="setTaaApplIf" statementType="CALLABLE" parameterType="java.util.HashMap" >
  		{ call P_WTM_IF_TAA_APPL( 
  				#{tenantId, jdbcType=BIGINT, javaType=java.lang.Long, mode=IN}
  			  , #{enterCd, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{sabun, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{taaCd, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{sYmd, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{eYmd, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{sHm, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{eHm, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{ifApplNo, jdbcType=BIGINT, javaType=java.lang.Long, mode=IN}
  			  , #{status, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{retCode,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}
  			  , #{retMsg,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}
  			  , #{taaApplId,jdbcType=BIGINT, javaType=java.lang.Long, mode=OUT}
  			  , #{applId,jdbcType=BIGINT, javaType=java.lang.Long, mode=OUT}
  			  , #{oldStatus,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}
  			  ) }
  	</select>
  	<select id="setTaaApplDayIf" statementType="CALLABLE" parameterType="java.util.HashMap" >
  		{ call P_WTM_IF_TAA_APPL_DAY( 
  				#{tenantId, jdbcType=BIGINT, javaType=java.lang.Long, mode=IN}
  			  , #{enterCd, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{sabun, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{taaCd, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{ymd, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{sHm, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{eHm, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{taaApplId,jdbcType=BIGINT, javaType=java.lang.Long, mode=IN}
  			  , #{applId,jdbcType=BIGINT, javaType=java.lang.Long, mode=IN}
  			  , #{status,jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{oldStatus,jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{retCode,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}
  			  , #{retMsg,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}
  			  , #{timeTypeCd,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}
  			  , #{taaSetYn,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}
  			  , #{taaSdate,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}
  			  , #{taaEdate,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}
  			  ) }
  	</select>
  	
  	<select id="getWtmTaaApplId" parameterType="map" resultType="hashmap">
		SELECT TAA_APPL_ID as taaApplId
		  FROM WTM_TAA_APPL
		 WHERE TENANT_ID = #{tenantId}
		   AND ENTER_CD = #{enterCd}
		   AND IF_APPL_NO = #{ifApplNo}
	</select>
	
	<select id="setWorkTimeCloseIf" statementType="CALLABLE" parameterType="java.util.HashMap" >
  		{ call P_WTM_CLOSE_WORKTIME( 
  				#{tenantId, jdbcType=BIGINT, javaType=java.lang.Long, mode=IN}
  			  , #{enterCd, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{ym, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{sYmd, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{eYmd, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{sabun, jdbcType=VARCHAR, javaType=java.lang.String, mode=IN}
  			  , #{retCode,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}
  			  , #{retMsg,jdbcType=VARCHAR, javaType=java.lang.String, mode=OUT}
  			  ) }
  	</select>
  	
  	<select id="getExceptRuleId" parameterType="map" resultType="hashmap">
        <![CDATA[
        	SELECT info_data
			  FROM comm_management_infomation
			 WHERE tenant_id = #{tenantId}
			   AND info_key = 'HR.IT_URL'
        ]]>
    </select>
    
    <select id="setCalcDay" parameterType="Long" resultType="hashmap">
        <![CDATA[
        	SELECT DISTINCT ENTER_CD AS enterCd
				  , SABUN AS sabun
				  , YMD AS ymd
			  FROM WTM_WORK_DAY_RESULT 
			WHERE TENANT_ID = #{tenantId}
			  AND YMD BETWEEN '20191104' AND '20191201'
			  AND PLAN_MINUTE IS NOT NULL
			  AND APPR_MINUTE IS NULL
        ]]>
    </select>
    
    <select id="setCalcDayResult" parameterType="Long" resultType="hashmap">
        <![CDATA[
        	SELECT ENTER_CD AS enterCd
				  , SABUN AS sabun
				  , YMD AS ymd
				  , TIME_TYPE_CD AS time_type_cd
				  , F_WTM_DATE_FORMAT(PLAN_SDATE, 'YMDHI') AS planSdate
				  , F_WTM_DATE_FORMAT(PLAN_EDATE, 'YMDHI') AS planEdate
				  , (SELECT TIME_CD_MGR_ID FROM WTM_WORK_CALENDAR B 
				      WHERE A.TENANT_ID = B.TENANT_ID
						  AND A.ENTER_CD = B.ENTER_CD
						  AND A.SABUN = B.SABUN
						  AND A.YMD = B.YMD) AS timeCdMgrId
				  , WORK_DAY_RESULT_ID AS workDayResultId
			  FROM WTM_WORK_DAY_RESULT A
			 WHERE TENANT_ID = #{tenantId}
			   AND PLAN_SDATE IS NOT NULL
				AND PLAN_EDATE IS NOT NULL
				AND YMD BETWEEN '20191201' AND '20191231'
			 ORDER BY ENTER_CD, SABUN
        ]]>
    </select>
    
    <insert id="insertDayResult" parameterType="map">
    	<![CDATA[
    		INSERT INTO WTM_WORK_DAY_RESULT(TENANT_ID, ENTER_CD, YMD, SABUN, TIME_TYPE_CD, PLAN_SDATE, PLAN_EDATE, PLAN_MINUTE, UPDATE_DATE, UPDATE_ID)
			SELECT C.TENANT_ID, C.ENTER_CD, C.YMD, C.SABUN, 'BASE', C.ENTRY_SDATE, C.ENTRY_EDATE, #{planMinute}, now(), '1'
				  FROM WTM_WORK_CALENDAR C
				 WHERE C.TENANT_ID = #{tenantId}
				   AND C.ENTER_CD = #{enterCd}
				   AND C.YMD = #{ymd} 
				   AND C.SABUN = #{sabun}
    	]]>
    </insert>
    <insert id="updateDayResult" parameterType="map">
    	<![CDATA[
    		UPDATE WTM_WORK_DAY_RESULT SET 
				PLAN_MINUTE = ${planMinute}
				 WHERE TENANT_ID = #{tenantId}
				   AND ENTER_CD = #{enterCd}
				   AND YMD = #{ymd} 
				   AND SABUN = #{sabun}
				   AND TIME_TYPE_CD = 'BASE'
    	]]>
    </insert>
    <insert id="updateDayResult2" parameterType="map">
    	<![CDATA[
    		UPDATE WTM_WORK_DAY_RESULT SET 
				PLAN_MINUTE = ${planMinute}
		    WHERE WORK_DAY_RESULT_ID = ${workDayResultId}
    	]]>
    </insert>
    
</mapper>
